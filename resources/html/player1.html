<html>

<head>
    <link href="../css/index.css" type="text/css" rel="stylesheet">
    <link href="../css/table.css" type="text/css" rel="stylesheet">
    <link href="../css/start.css" type="text/css" rel="stylesheet">
    <script src="../js/jquery-3.5.0.min.js"></script>
    <script src="../js/game.js"></script>
    <script src="../js/cards.js"></script>
    <script src="../js/html-generator.js"></script>
    <script src="../js/session.js"></script>
    <script src="../js/utils.js"></script>

    <title>
        <!-- Title generated by JavaScript-->
    </title>

    <script>
        $(document).ready(function () {
            var n = 1;
            document.title = "Cartes de " + getPlayerName(n);
            $(`#titlePlayer${n}`).text(`Cartes de ${getPlayerName(n)}`);
            var Cards = window.opener.getSessionCards();
            if (window.opener.sessionStorage.getItem(`player${n}Panel`) == null) { // Inicialització a l'inici de la partida 
                generatePlayerPanelsHTML(n);
                initializePlayerSets(n);
                Cards = getSessionCards();
            } else {
                $(`#player${n}Panel`).html(window.opener.sessionStorage.getItem(`player${n}Panel`));
                var movedCards = window.opener.getSessionMovedArray().length != 0;
                if (movedCards) {
                    $(`#player${n}NewPanel`).hide();
                    throwCards(n);
                } else if (window.opener.getSessionCards().length != 0) { // Si queden cartes per robar
                    $(`#player${n}NewPanel`).show();
                    takeCard(n);
                    Cards = getSessionCards();
                }
            }
            if (window.opener.getSessionCards().length != 0) {
                var playerCards = getSessionPlayerCards(n);
                window.opener.sessionStorage.setItem("Cards", JSON.stringify(Cards));
                window.opener.sessionStorage.setItem(`player${n}Panel`, $(`#player${n}Panel`).html());
                window.opener.sessionStorage.setItem(`player${n}Cards`, JSON.stringify(playerCards));
                window.opener.setSessionMovedArray([]);
            }
            window.opener.$("#cardsLeft").text(`Cartes restants: ${window.opener.getSessionCards().length}`);
        }); 
    </script>

</head>

<body>
    <h1 id="titlePlayer1" style="margin-top: 2cm; margin-bottom: 2cm;"></h1>
    <div id="player1Panel">
        <!-- This table is generated by JavaScript-->
    </div>

    <div style="margin-top: 60px;"></div>

    <div id="player1NewPanel" style="text-align: center; display: none">
        <div style="display: inline-block;">
            <label> La teva nova carta és:</label>
        </div>
        <div style="width:15px; display: inline-block;">
        </div>
        <div style="display: inline-block;">
            <table>
                <tr>
                    <td id="player1NewCard" class="emptyCell"></td>
                </tr>
            </table>
        </div>
    </div>
</body>

</html>